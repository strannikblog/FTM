# CHANGELOG - RiskManager
**Session Start: 2025-11-16 11:55**

## Version History

### Current Session Changes

#### Version 1.0 (2025-11-16 11:55) - Session Setup
**Changes Made:**
- Created CHANGELOG_2025-11-16_1155.md for current session tracking
- Updated TASKS.md for current session (2025-11-16)
- Corrected working directory path to current location
- Updated current version reference to RiskManager_v1.53_DynamicRiskOutput.mq5
- Synchronized changelog reference in TASKS.md to new session file
- Updated documentation file references and last updated timestamp

**Files Affected:**
- Documentation/CHANGELOG_2025-11-16_1155.md (created)
- Documentation/TASKS.md (updated)

**Reason for Change:**
Session initialization and task management system setup for methodical development tracking.

#### Version 1.1 (2025-11-16 12:05) - Static Override Implementation
**Changes Made:**
- Created RiskManager_v1.54_StaticOverride.mq5 with dual-protection risk management
- Added Static Override system with configurable drawdown thresholds:
  - DD < 5%: No restriction (full dynamic range available)
  - 5% ≤ DD < 7%: MAX risk capped at 1.0%
  - 7% ≤ DD < 10%: MAX risk capped at 0.5% (emergency mode)
  - DD ≥ 10%: Trading halted (0.0% risk)
- Enhanced state structure with Static Override tracking variables
- Implemented ApplyStaticOverride() function for real-time risk capping
- Updated display to show both dynamic and final risk levels
- Added Static Override status indicator in main panel
- Enhanced transaction logging with drawdown and static cap information
- Integrated Static Override into all risk management functions
- Updated CSV state format to include new Static Override fields
- Maintained backward compatibility with existing features

**Files Affected:**
- RiskManager_v1.54_StaticOverride.mq5 (created)

**Reason for Change:**
Implementation of professional-grade dual-protection risk management system combining consecutive loss-based dynamic risk reduction with drawdown-based static override for comprehensive account protection.

#### Version 1.2 (2025-11-16 12:15) - Static Override Display Fix
**Changes Made:**
- Fixed display logic showing confusing arrow and dynamic level information
- Removed incorrect "Level: MID (1.0%) → 2.0% ⬆️" display
- Static Override now works silently in background showing only final risk level
- Maintained original display behavior: "Level: MID (1.0%)" format
- Level text still based on dynamic risk percent (correct behavior)
- Risk percentage shows final capped risk level
- Static Override status shown separately in dedicated line

**Files Affected:**
- RiskManager_v1.55_StaticOverride_Fixed.mq5 (created)

**Reason for Change:**
User feedback identified confusing display behavior. Static Override should apply caps silently without showing uncapped risk levels, maintaining clean user interface consistent with original design principles.

#### Version 1.3 (2025-11-16 13:20) - Critical Bug Fix: Dynamic Risk Level Preservation
**Changes Made:**
- Fixed critical bug where `ApplyStaticOverride()` was overwriting `dynamicRiskPercent` with capped risk values
- Removed line: `state.dynamicRiskPercent = state.currentRiskPercent;` that was corrupting dynamic levels
- Static Override now preserves original dynamic risk levels correctly
- Dynamic level display now shows correct values when Static Override is enabled but inactive
- Fixed issue where Static Override "Inactive" status was still affecting level calculations

**Files Affected:**
- RiskManager_v1.56_StaticOverride_Fixed.mq5 (created)

**Reason for Change:**
Critical bug discovered where enabling Static Override (even when inactive) corrupted dynamic risk level calculations, showing incorrect risk percentages in level display. Static Override must preserve dynamic risk levels and only apply caps when needed.

#### Version 1.4 (2025-11-16 15:45) - Comprehensive Code Quality Improvements
**Changes Made:**
- Fixed compilation errors: undefined `g_state` variable references in Static Override functions
- Corrected all state variable references from `g.state` to `g_state` throughout the codebase
- Enhanced CSV state format to include 26 total fields with Static Override integration
- Added new CSV fields: staticRiskCeiling (field 21), tradingHalted (field 22), currentDrawdown (field 23)
- Updated state persistence to track Static Override status and drawdown calculations
- Fixed CSV parsing in LoadState() to handle all 26 fields correctly
- Enhanced debug logging with improved Static Override status messages
- Fixed CSV state saving format to include all new fields with proper separators

**Files Affected:**
- RiskManager_v1.57_StaticOverride_BugFixes.mq5 (created)

**Reason for Change:**
Multiple compilation errors and state persistence issues discovered in v1.56. Required comprehensive fix of all state variable references and CSV format updates to support Static Override functionality correctly.

#### Version 1.5 (2025-11-16 16:15) - Panel Dimension Optimization
**Changes Made:**
- Updated default panel dimensions for optimal display:
  - panelWidth: 420 pixels (from 380)
  - panelHeight: 290 pixels (from 260)
- Maintained all other display settings and functionality
- No changes to risk management logic or state management
- Enhanced UI space for better visibility of Static Override information

**Files Affected:**
- RiskManager_v1.58_StaticOverride_BugFixes.mq5 (created)

**Reason for Change:**
User requested specific panel dimension changes to improve UI layout and accommodate additional Static Override information display.

#### Version 1.6 (2025-11-16 16:45) - Display Rounding Fix & UI Optimization
**Changes Made:**
- **Fixed display rounding bug**: Changed DoubleToString precision from 1 to 2 decimal places
  - Line 208: Risk file logging: `DoubleToString(currentRiskPercent, 2)`
  - Line 998: Panel display: `DoubleToString(g_state.currentRiskPercent, 2)`
  - Lines 159-161: Static Override logging: All changed to 2 decimal precision
- **Panel dimension optimization**: Updated panel sizing for more compact display
  - panelWidth: 245 pixels (from 270px, -25px narrower)
  - Height with DD + Static: 220px (from 299px, -79px shorter)
  - Height with one line: 205px (from 281px, -76px shorter)
  - Height without extras: 185px (from 263px, -78px shorter)
- **Problem solved**: MIN level now displays as "0.25%" instead of rounded "0.3%"
- **Calculation integrity**: Internal risk calculations were always correct (purely cosmetic display issue)

**Files Affected:**
- RiskManager_v1.58_RoundingFix.mq5 (created)

**Reason for Change:**
User identified display rounding issue where MIN level (0.25%) was showing as (0.3%) due to 1-decimal place formatting. Also requested more compact panel dimensions for better screen real estate usage.

---

## Previous Versions
*(Previous versions will be listed here as new versions are created)*

---

## Change Summary Format
Each entry will include:
- Version number
- Date and time of change
- Detailed description of modifications made
- Files affected
- Reason for change (if applicable)